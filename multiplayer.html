<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå Numero Quest: Arena Multiplayer Galattica</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@400;700;900&family=Exo+2:wght@400;700;900&family=Righteous&family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <!-- Socket.io da CDN per compatibilit√† Vercel -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <style>
        :root {
            /* PALETTE COSMICA AVANZATA */
            --cosmic-primary: #00fff2;
            --cosmic-secondary: #ff6b6b;
            --cosmic-accent: #ffd93d;
            --cosmic-purple: #9966ff;
            --cosmic-green: #00ff66;
            --cosmic-orange: #ff6600;
            --cosmic-pink: #ff69b4;
            --cosmic-blue: #4169e1;
            
            /* GRADIENTI SPAZIALI */
            --cosmic-bg: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            --nebula-bg: radial-gradient(ellipse at center, rgba(153,102,255,0.4) 0%, rgba(0,255,242,0.3) 50%, transparent 100%);
            --aurora-bg: linear-gradient(45deg, rgba(0,255,242,0.2), rgba(255,107,107,0.2), rgba(255,215,61,0.2), rgba(153,102,255,0.2));
            
            /* EFFETTI LUMINOSI */
            --glow-primary: 0 0 30px var(--cosmic-primary);
            --glow-secondary: 0 0 30px var(--cosmic-secondary);
            --glow-accent: 0 0 30px var(--cosmic-accent);
            --card-glow: 0 0 40px rgba(0,255,242,0.3);
            
            /* TRASPARENZE */
            --glass-bg: rgba(255,255,255,0.08);
            --glass-border: rgba(0,255,242,0.3);
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--cosmic-bg);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            overflow-x: hidden;
            animation: cosmicBreathing 12s ease-in-out infinite;
        }

        @keyframes cosmicBreathing {
            0%, 100% { background: var(--cosmic-bg); }
            50% { background: linear-gradient(135deg, #1a0a2e 0%, #2e1a4a 25%, #1e2a5e 50%, #0f4060 75%, #634a93 100%); }
        }

        /* SISTEMA DI PARTICELLE AVANZATO */
        #particles-js {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -5;
        }

        .cosmic-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--nebula-bg);
            z-index: -4;
            animation: nebulaFlow 20s ease-in-out infinite;
        }

        @keyframes nebulaFlow {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.7; }
            33% { transform: scale(1.1) rotate(2deg); opacity: 0.9; }
            66% { transform: scale(0.9) rotate(-1deg); opacity: 0.8; }
        }

        .aurora-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--aurora-bg);
            z-index: -3;
            animation: auroraShift 25s linear infinite;
            opacity: 0.6;
        }

        @keyframes auroraShift {
            0% { transform: translateX(-100%) skewX(10deg); }
            100% { transform: translateX(100%) skewX(10deg); }
        }

        .stars-field {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -2;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: starTwinkle 4s ease-in-out infinite;
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.8); }
        }

        .shooting-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--cosmic-accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--cosmic-accent);
            animation: shootingStar 5s linear infinite;
        }

        @keyframes shootingStar {
            0% {
                transform: translateX(-200px) translateY(-200px);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateX(calc(100vw + 200px)) translateY(calc(100vh + 200px));
                opacity: 0;
            }
        }

        /* LOGO COSMICO AVANZATO */
        .cosmic-logo {
            width: 200px;
            height: 200px;
            margin-bottom: 2rem;
            border-radius: 50%;
            background: conic-gradient(var(--cosmic-primary), var(--cosmic-purple), var(--cosmic-accent), var(--cosmic-secondary), var(--cosmic-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            animation: logoRotate 15s linear infinite, logoGlow 4s ease-in-out infinite alternate;
            box-shadow: 
                var(--glow-primary),
                inset 0 0 40px rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }

        .cosmic-logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, var(--cosmic-primary), transparent, var(--cosmic-accent), transparent);
            animation: logoSpin 4s linear infinite;
            z-index: -1;
        }

        .cosmic-logo::after {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            right: 10%;
            bottom: 10%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            animation: logoShine 6s ease-in-out infinite;
        }

        @keyframes logoRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes logoGlow {
            0% { box-shadow: var(--glow-primary), inset 0 0 40px rgba(255,255,255,0.3); }
            100% { box-shadow: 0 0 60px var(--cosmic-primary), inset 0 0 60px rgba(255,255,255,0.5); }
        }

        @keyframes logoSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes logoShine {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        /* TITOLI EPICI MIGLIORATI */
        h1 {
            font-family: 'Bangers', cursive;
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            margin: 0 0 1.5rem;
            background: linear-gradient(45deg, var(--cosmic-primary), var(--cosmic-accent), var(--cosmic-purple), var(--cosmic-secondary), var(--cosmic-primary));
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 5s ease-in-out infinite, titleFloat 8s ease-in-out infinite;
            text-shadow: 0 0 40px rgba(0,255,242,0.6);
            position: relative;
            filter: drop-shadow(0 0 20px rgba(0,255,242,0.5));
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-15px) scale(1.03); }
        }

        h1::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: titleSweep 4s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes titleSweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* CONTAINERS FUTURISTICI AVANZATI */
        .container {
            background: var(--glass-bg);
            padding: 2.5rem;
            border-radius: 30px;
            backdrop-filter: blur(25px);
            box-shadow: 
                var(--card-glow),
                inset 0 0 30px rgba(255,255,255,0.1);
            width: 100%;
            max-width: 550px;
            margin: 1.5rem 0;
            animation: containerFloat 10s ease-in-out infinite;
            border: 3px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(0,255,242,0.15), transparent, rgba(255,107,107,0.1), transparent);
            animation: containerRotate 20s linear infinite;
            z-index: -1;
        }

        .container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 30px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: containerShine 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes containerFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes containerRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes containerShine {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* CONNECTION ERROR SCREEN */
        .connection-error {
            background: rgba(255, 107, 107, 0.25);
            border: 4px solid var(--cosmic-secondary);
            border-radius: 25px;
            padding: 2.5rem;
            margin: 2.5rem 0;
            text-align: center;
            backdrop-filter: blur(15px);
            animation: errorPulse 3s ease-in-out infinite;
        }

        @keyframes errorPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(255,107,107,0.4); }
            50% { box-shadow: 0 0 50px rgba(255,107,107,0.7); }
        }

        .connection-error h3 {
            color: var(--cosmic-secondary);
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 15px var(--cosmic-secondary);
        }

        /* INPUTS E BUTTONS FUTURISTICI AVANZATI */
        input, select, button {
            width: 100%;
            padding: 1.2rem;
            margin: 1rem 0;
            font-size: 1.1rem;
            border-radius: 20px;
            border: 3px solid var(--cosmic-primary);
            font-weight: 700;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        input, select {
            background: rgba(0,0,0,0.5);
            color: white;
            backdrop-filter: blur(15px);
            box-shadow: inset 0 0 20px rgba(0,255,242,0.1);
        }

        input::placeholder {
            color: rgba(255,255,255,0.6);
            font-weight: 600;
        }

        input:focus, select:focus {
            outline: none;
            box-shadow: 
                var(--glow-primary),
                inset 0 0 25px rgba(0,255,242,0.3);
            transform: scale(1.03);
            border-color: var(--cosmic-accent);
        }

        button {
            background: linear-gradient(45deg, var(--cosmic-primary), var(--cosmic-green));
            color: black;
            cursor: pointer;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: var(--glow-primary);
            border: 3px solid transparent;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.8s ease;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover { 
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 15px 35px rgba(0,255,242,0.6);
            background: linear-gradient(45deg, var(--cosmic-accent), var(--cosmic-primary));
        }

        button:active {
            transform: translateY(-2px) scale(1.01);
        }

        button:disabled {
            background: linear-gradient(45deg, #666, #888);
            color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* BUTTONS SPECIALI MIGLIORATI */
        .btn-secondary {
            background: linear-gradient(45deg, var(--cosmic-secondary), var(--cosmic-orange));
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, var(--cosmic-orange), var(--cosmic-secondary));
            box-shadow: var(--glow-secondary);
        }

        .btn-success {
            background: linear-gradient(45deg, var(--cosmic-green), #4caf50);
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #4caf50, var(--cosmic-green));
            box-shadow: 0 15px 35px rgba(0,255,102,0.6);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--cosmic-secondary), #e74c3c);
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #e74c3c, var(--cosmic-secondary));
            box-shadow: var(--glow-secondary);
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--cosmic-accent), #f39c12);
        }

        .btn-warning:hover {
            background: linear-gradient(45deg, #f39c12, var(--cosmic-accent));
            box-shadow: var(--glow-accent);
        }

        /* STATUS INDICATORS COSMICI AVANZATI */
        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 12px;
            position: relative;
            box-shadow: 0 0 15px currentColor;
        }

        .status-indicator::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            border: 3px solid currentColor;
            animation: statusPulse 2.5s ease-in-out infinite;
        }

        .status-indicator::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border-radius: 50%;
            border: 1px solid currentColor;
            animation: statusRipple 3s ease-in-out infinite;
            opacity: 0.5;
        }

        @keyframes statusPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.8); opacity: 0.3; }
        }

        @keyframes statusRipple {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(2); opacity: 0.1; }
        }

        .status-online { 
            background-color: var(--cosmic-green);
            color: var(--cosmic-green);
        }
        
        .status-offline { 
            background-color: var(--cosmic-secondary);
            color: var(--cosmic-secondary);
        }
        
        .status-connecting { 
            background-color: var(--cosmic-accent);
            color: var(--cosmic-accent);
            animation: connectingPulse 1.5s infinite;
        }

        @keyframes connectingPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.4); }
        }

        /* CARDS E LISTE MIGLIORATE */
        .cosmic-card {
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 2px solid rgba(0,255,242,0.3);
            backdrop-filter: blur(15px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .cosmic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,242,0.2), transparent);
            transition: left 0.8s ease;
        }

        .cosmic-card:hover {
            border-color: var(--cosmic-primary);
            box-shadow: var(--card-glow);
            transform: translateY(-5px) scale(1.02);
        }

        .cosmic-card:hover::before {
            left: 100%;
        }

        .player-list {
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 3px solid var(--cosmic-purple);
            backdrop-filter: blur(15px);
            position: relative;
        }

        .player-list::before {
            content: 'üë• COMANDANTI GALATTICI';
            position: absolute;
            top: -15px;
            left: 25px;
            background: var(--cosmic-bg);
            padding: 0 15px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--cosmic-purple);
            border-radius: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem;
            margin: 1rem 0;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            border: 2px solid rgba(0,255,242,0.2);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .player-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .player-item:hover {
            background: rgba(0,255,242,0.15);
            transform: scale(1.03);
            box-shadow: 0 0 20px rgba(0,255,242,0.4);
        }

        .player-item:hover::before {
            left: 100%;
        }

        .player-item.host {
            border-color: var(--cosmic-accent);
            background: rgba(255,215,61,0.15);
            position: relative;
        }

        .player-item.host::after {
            content: 'üëë';
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 1.5rem;
            animation: crownFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px var(--cosmic-accent));
        }

        @keyframes crownFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(10deg); }
        }

        /* CHAT FUTURISTICO AVANZATO */
        .chat-container {
            height: 280px;
            overflow-y: auto;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 3px solid var(--cosmic-green);
            backdrop-filter: blur(15px);
            position: relative;
        }

        .chat-container::before {
            content: 'üí¨ COMUNICAZIONI GALATTICHE';
            position: absolute;
            top: -15px;
            left: 25px;
            background: var(--cosmic-bg);
            padding: 0 15px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--cosmic-green);
            border-radius: 10px;
        }

        .chat-message {
            margin: 1rem 0;
            padding: 1.2rem;
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            border-left: 4px solid var(--cosmic-primary);
            animation: messageSlide 0.6s ease-out;
            position: relative;
            backdrop-filter: blur(10px);
        }

        @keyframes messageSlide {
            from { 
                opacity: 0; 
                transform: translateX(-30px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        .chat-message.system {
            border-left-color: var(--cosmic-accent);
            background: rgba(255,215,61,0.15);
            font-style: italic;
        }

        .chat-message.own {
            border-left-color: var(--cosmic-green);
            background: rgba(0,255,102,0.15);
            margin-left: 30px;
        }

        /* LEADERBOARD EPICA AVANZATA */
        .leaderboard {
            background: rgba(0,0,0,0.5);
            border-radius: 25px;
            padding: 2.5rem;
            margin: 2rem 0;
            border: 4px solid var(--cosmic-accent);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .leaderboard::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,215,61,0.15), transparent, rgba(0,255,242,0.1), transparent);
            animation: leaderboardRotate 25s linear infinite;
            z-index: -1;
        }

        .leaderboard::after {
            content: 'üèÜ HALL OF FAME GALATTICA';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--cosmic-bg);
            padding: 0 20px;
            font-size: 1rem;
            font-weight: bold;
            color: var(--cosmic-accent);
            border-radius: 15px;
            border: 2px solid var(--cosmic-accent);
        }

        @keyframes leaderboardRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .leaderboard h3, .leaderboard h4 {
            text-align: center;
            margin-bottom: 2rem;
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: var(--cosmic-accent);
            text-shadow: 0 0 20px var(--cosmic-accent);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 20px var(--cosmic-accent); }
            100% { text-shadow: 0 0 40px var(--cosmic-accent); }
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            margin: 1.2rem 0;
            border-radius: 20px;
            transition: all 0.4s ease;
            position: relative;
            font-weight: 700;
            border: 3px solid transparent;
            backdrop-filter: blur(10px);
        }

        .leaderboard-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255,255,255,0.4);
        }

        .leaderboard-item.first {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: black;
            border-color: #ffd700;
            box-shadow: 0 0 40px rgba(255,215,0,0.6);
            animation: goldGlow 4s ease-in-out infinite alternate;
        }

        @keyframes goldGlow {
            0% { box-shadow: 0 0 40px rgba(255,215,0,0.6); }
            100% { box-shadow: 0 0 60px rgba(255,215,0,0.9); }
        }

        .leaderboard-item.first::before {
            content: 'ü•á';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2.5rem;
            animation: medalFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 15px #ffd700);
        }

        @keyframes medalFloat {
            0%, 100% { transform: translateY(-50%) rotate(0deg); }
            50% { transform: translateY(-70%) rotate(15deg); }
        }

        .leaderboard-item.second {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
            color: black;
            border-color: #c0c0c0;
            box-shadow: 0 0 30px rgba(192,192,192,0.6);
        }

        .leaderboard-item.second::before {
            content: 'ü•à';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2.5rem;
            filter: drop-shadow(0 0 15px #c0c0c0);
        }

        .leaderboard-item.third {
            background: linear-gradient(45deg, #cd7f32, #daa520);
            color: black;
            border-color: #cd7f32;
            box-shadow: 0 0 30px rgba(205,127,50,0.6);
        }

        .leaderboard-item.third::before {
            content: 'ü•â';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2.5rem;
            filter: drop-shadow(0 0 15px #cd7f32);
        }

        /* NOTIFICHE SPECIALI AVANZATE */
        .auto-start-notification {
            background: rgba(255, 193, 7, 0.25);
            border: 4px solid var(--cosmic-accent);
            border-radius: 25px;
            padding: 2rem;
            margin: 2rem 0;
            animation: notificationPulse 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }

        .auto-start-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: notificationSweep 4s ease-in-out infinite;
        }

        @keyframes notificationPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255,193,7,0.4); }
            50% { transform: scale(1.03); box-shadow: 0 0 50px rgba(255,193,7,0.7); }
        }

        @keyframes notificationSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .countdown {
            font-size: 2rem;
            font-weight: 900;
            color: var(--cosmic-accent);
            text-shadow: 0 0 20px var(--cosmic-accent);
            animation: countdownPulse 1.2s ease-in-out infinite;
        }

        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .level-completed {
            background: rgba(76, 175, 80, 0.25);
            border: 4px solid var(--cosmic-green);
            border-radius: 25px;
            padding: 2.5rem;
            margin: 2rem 0;
            animation: levelCompletedCelebration 4s ease-in-out;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }

        @keyframes levelCompletedCelebration {
            0% { transform: scale(0.8); opacity: 0; }
            20% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .winner-announcement {
            background: linear-gradient(45deg, var(--cosmic-accent), var(--cosmic-secondary), var(--cosmic-primary));
            color: black;
            padding: 3rem;
            border-radius: 30px;
            margin: 2.5rem 0;
            font-weight: 900;
            animation: winnerCelebration 5s ease-in-out infinite;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(255,215,61,0.8);
            border: 4px solid var(--cosmic-accent);
        }

        @keyframes winnerCelebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.08) rotate(2deg); }
            75% { transform: scale(1.08) rotate(-2deg); }
        }

        .winner-announcement::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.4), transparent);
            animation: winnerRotate 3s linear infinite;
            z-index: -1;
        }

        @keyframes winnerRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* GAME HISTORY MIGLIORATA */
        .game-history {
            height: 220px;
            overflow-y: auto;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 3px solid var(--cosmic-purple);
            backdrop-filter: blur(15px);
            position: relative;
        }

        .game-history::before {
            content: 'üìä CRONOLOGIA BATTAGLIA GALATTICA';
            position: absolute;
            top: -15px;
            left: 25px;
            background: var(--cosmic-bg);
            padding: 0 15px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--cosmic-purple);
            border-radius: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            margin: 0.8rem 0;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(255,255,255,0.08);
            transition: all 0.4s ease;
            backdrop-filter: blur(5px);
        }

        .history-item:hover {
            background: rgba(0,255,242,0.15);
            transform: translateX(8px);
            box-shadow: 0 0 15px rgba(0,255,242,0.3);
        }

        /* ROOM CODE DISPLAY MIGLIORATO */
        .room-code-display {
            background: rgba(0,0,0,0.6);
            padding: 2rem;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 4px;
            margin: 1.5rem 0;
            border: 4px solid var(--cosmic-primary);
            text-align: center;
            color: var(--cosmic-primary);
            text-shadow: 0 0 20px var(--cosmic-primary);
            animation: codeGlow 4s ease-in-out infinite alternate;
            position: relative;
            overflow: hidden;
        }

        .room-code-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,242,0.3), transparent);
            animation: codeSweep 3s ease-in-out infinite;
        }

        @keyframes codeGlow {
            0% { 
                box-shadow: 0 0 30px rgba(0,255,242,0.4);
                text-shadow: 0 0 20px var(--cosmic-primary);
            }
            100% { 
                box-shadow: 0 0 60px rgba(0,255,242,0.8);
                text-shadow: 0 0 40px var(--cosmic-primary);
            }
        }

        @keyframes codeSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* LEVEL DISPLAY MIGLIORATO */
        .level-display {
            background: rgba(0,255,242,0.15);
            border: 4px solid var(--cosmic-primary);
            border-radius: 25px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }

        .level-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,242,0.3), transparent);
            animation: levelSweep 5s ease-in-out infinite;
        }

        @keyframes levelSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .level-display h4 {
            margin: 0 0 1.5rem 0;
            color: var(--cosmic-primary);
            font-family: 'Bangers', cursive;
            font-size: 1.6rem;
            text-shadow: 0 0 15px var(--cosmic-primary);
        }

        /* PROGRESS BARS COSMICHE AVANZATE */
        .cosmic-progress {
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 3px solid var(--cosmic-accent);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }

        .cosmic-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,61,0.2), transparent);
            animation: progressSweep 4s ease-in-out infinite;
        }

        @keyframes progressSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* UTILITIES AVANZATE */
        .hidden { display: none !important; }

        .text-center { text-align: center; }

        .glow-text {
            text-shadow: 0 0 20px currentColor;
            animation: textGlow 3s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 20px currentColor; }
            100% { text-shadow: 0 0 35px currentColor; }
        }

        /* RESPONSIVE DESIGN MIGLIORATO */
        @media screen and (max-width: 768px) {
            h1 { font-size: 2.8rem; }
            .container { 
                padding: 2rem; 
                max-width: 95%;
            }
            .cosmic-logo {
                width: 150px;
                height: 150px;
                font-size: 4rem;
            }
            .leaderboard-item {
                padding: 1.2rem;
                font-size: 0.95rem;
            }
            .chat-container {
                height: 220px;
            }
            .game-history {
                height: 180px;
            }
        }

        @media screen and (max-width: 480px) {
            h1 { font-size: 2.2rem; }
            .container { padding: 1.5rem; }
            .cosmic-logo {
                width: 120px;
                height: 120px;
                font-size: 3rem;
            }
            input, select, button {
                padding: 1rem;
                font-size: 1rem;
            }
        }

        /* SCROLLBAR PERSONALIZZATA AVANZATA */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, var(--cosmic-primary), var(--cosmic-purple));
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0,255,242,0.5);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, var(--cosmic-accent), var(--cosmic-secondary));
            box-shadow: 0 0 15px rgba(255,215,61,0.7);
        }

        /* EFFETTI SPECIALI AVANZATI */
        .cosmic-sparkle {
            position: relative;
        }

        .cosmic-sparkle::after {
            content: '‚ú®';
            position: absolute;
            top: -15px;
            right: -15px;
            animation: sparkleFloat 3s ease-in-out infinite;
            font-size: 1.2rem;
        }

        @keyframes sparkleFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-8px) rotate(180deg); opacity: 1; }
        }

        /* LOADING ANIMATIONS AVANZATE */
        .cosmic-loading {
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 4px solid rgba(0,255,242,0.3);
            border-radius: 50%;
            border-top-color: var(--cosmic-primary);
            animation: cosmicSpin 1.2s ease-in-out infinite;
        }

        @keyframes cosmicSpin {
            to { transform: rotate(360deg); }
        }

        /* HOVER EFFECTS GLOBALI */
        .interactive-element {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .interactive-element:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }
    </style>
</head>
<body>

<!-- BACKGROUND EFFECTS AVANZATI -->
<div id="particles-js"></div>
<div class="cosmic-overlay"></div>
<div class="aurora-layer"></div>
<div class="stars-field" id="starsField"></div>

<!-- LOGO COSMICO AVANZATO -->
<div class="cosmic-logo">üåå</div>

<!-- Lobby Screen -->
<div class="container" id="lobby">
    <h1>üåå ARENA MULTIPLAYER GALATTICA</h1>
    <div style="text-align: center; margin-bottom: 2rem;">
        <div style="font-family: 'Orbitron', monospace; font-size: 1.3rem; color: var(--cosmic-accent); text-shadow: 0 0 15px var(--cosmic-accent);">
            BATTAGLIA NUMERICA INTERGALATTICA
        </div>
    </div>
    
    <div style="display: flex; align-items: center; justify-content: center; margin: 2rem 0;">
        <span class="status-indicator" id="connectionStatus"></span>
        <span id="connectionText" style="font-weight: 700; font-size: 1.2rem;">Connessione al Network Galattico...</span>
    </div>

    <!-- Connection Error Screen -->
    <div id="connection-error" class="connection-error hidden">
        <h3>üîå CONNESSIONE NON DISPONIBILE</h3>
        <p style="margin-bottom: 2rem; font-size: 1.1rem;">
            Impossibile connettersi al server multiplayer.<br>
            Verifica la tua connessione internet e riprova.
        </p>
        <button id="retry-connection-btn" class="btn-warning cosmic-sparkle">üîÑ RIPROVA CONNESSIONE</button>
        <button onclick="goHome()" class="btn-danger" style="margin-top: 1rem;">üîô RITORNA AL MENU</button>
    </div>

    <div class="cosmic-card" id="online-features">
        <h3 style="color: var(--cosmic-primary); margin-bottom: 1.5rem; font-family: 'Bangers', cursive; font-size: 1.8rem;">üöÄ MODALIT√Ä BATTAGLIA COSMICA</h3>
        <div style="text-align: left;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin: 1.5rem 0;">
                <div style="background: rgba(0,255,242,0.15); padding: 1.5rem; border-radius: 15px; border: 2px solid var(--cosmic-primary); backdrop-filter: blur(10px);">
                    <strong style="color: var(--cosmic-primary); font-size: 1.1rem;">üéØ OBIETTIVO</strong><br>
                    <small style="line-height: 1.4;">10 livelli progressivi<br>Difficolt√† crescente<br>Battaglia fino alla fine<br>Sistema punteggi avanzato</small>
                </div>
                <div style="background: rgba(255,107,107,0.15); padding: 1.5rem; border-radius: 15px; border: 2px solid var(--cosmic-secondary); backdrop-filter: blur(10px);">
                    <strong style="color: var(--cosmic-secondary); font-size: 1.1rem;">‚ö° FEATURES</strong><br>
                    <small style="line-height: 1.4;">Auto-start intelligente<br>Chat tempo reale<br>Classifiche live<br>Effetti cosmici</small>
                </div>
            </div>
            
            <div style="background: rgba(255,215,61,0.15); padding: 2rem; border-radius: 20px; border: 3px solid var(--cosmic-accent); margin: 1.5rem 0; backdrop-filter: blur(15px);">
                <strong style="color: var(--cosmic-accent); font-size: 1.2rem;">üìä PROGRESSIONE DIFFICOLT√Ä GALATTICA:</strong><br><br>
                <div style="display: grid; grid-template-columns: 1fr; gap: 0.8rem; font-size: 1rem;">
                    <div style="padding: 0.5rem; background: rgba(0,255,102,0.1); border-radius: 8px;">üß© <strong style="color: var(--cosmic-green);">FACILE:</strong> 1-30 ‚Üí 1-60 ‚Üí 1-90 ‚Üí ... ‚Üí 1-300</div>
                    <div style="padding: 0.5rem; background: rgba(0,255,242,0.1); border-radius: 8px;">‚öîÔ∏è <strong style="color: var(--cosmic-primary);">MEDIO:</strong> 1-60 ‚Üí 1-120 ‚Üí 1-180 ‚Üí ... ‚Üí 1-600</div>
                    <div style="padding: 0.5rem; background: rgba(255,102,0,0.1); border-radius: 8px;">üî• <strong style="color: var(--cosmic-orange);">DIFFICILE:</strong> 1-150 ‚Üí 1-300 ‚Üí 1-450 ‚Üí ... ‚Üí 1-1500</div>
                    <div style="padding: 0.5rem; background: rgba(255,107,107,0.1); border-radius: 8px;">üíÄ <strong style="color: var(--cosmic-secondary);">HARDCORE:</strong> 1-300 ‚Üí 1-600 ‚Üí 1-900 ‚Üí ... ‚Üí 1-3000</div>
                </div>
            </div>
        </div>
    </div>

    <input type="text" id="playerName" placeholder="üöÄ Il tuo nome da Comandante Galattico" maxlength="20" class="interactive-element" />
    
    <select id="difficulty" class="interactive-element">
        <option value="easy">üß© FACILE - Esploratore Spaziale (1-30, 10 tentativi)</option>
        <option value="medium">‚öîÔ∏è MEDIO - Guerriero Cosmico (1-60, 8 tentativi)</option>
        <option value="hard">üî• DIFFICILE - Maestro Galattico (1-150, 7 tentativi)</option>
        <option value="hardcore">üíÄ HARDCORE - Leggenda Universale (1-300, 5 tentativi)</option>
    </select>
    
    <button id="create-game-btn" class="cosmic-sparkle interactive-element">üè† CREA STAZIONE SPAZIALE</button>
    
    <div style="margin: 2.5rem 0;">
        <input type="text" id="room-code" placeholder="üîë Codice Stazione (es: GALAXY123)" maxlength="10" style="text-transform: uppercase;" class="interactive-element" />
        <button id="join-game-btn" class="btn-secondary interactive-element">üö™ ENTRA NELLA STAZIONE</button>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <button id="random-room-btn" class="btn-warning interactive-element">üé≤ STAZIONE CASUALE</button>
        <button id="public-rooms-btn" class="btn-success interactive-element">üìã STAZIONI PUBBLICHE</button>
    </div>
    
    <div id="publicRoomsList" class="hidden cosmic-card">
        <h3 style="color: var(--cosmic-green); font-family: 'Bangers', cursive; font-size: 1.6rem;">üåç STAZIONI GALATTICHE DISPONIBILI:</h3>
        <div id="roomsList"></div>
    </div>
    
    <button onclick="goHome()" class="btn-danger interactive-element" style="margin-top: 2.5rem;">üîô RITORNA ALLA BASE</button>
</div>

<!-- Game Screen -->
<div class="container hidden" id="game">
    <h2 style="font-family: 'Bangers', cursive; color: var(--cosmic-primary); text-shadow: 0 0 20px var(--cosmic-primary); font-size: 2rem;">
        üöÄ STAZIONE: <span id="room-code-display" class="room-code-display"></span>
    </h2>
    
    <!-- Livello e Punteggi -->
    <div class="cosmic-progress">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <span style="font-size: 1.4rem; font-weight: 900; color: var(--cosmic-primary);">
                    üéØ SETTORE <span id="current-level">1</span>/10
                </span>
            </div>
            <div>
                <span style="font-size: 1.1rem; opacity: 0.9;">PUNTEGGIO COMANDANTE:</span><br>
                <span id="my-score" style="font-size: 1.8rem; font-weight: 900; color: var(--cosmic-accent); text-shadow: 0 0 15px var(--cosmic-accent);">0</span>
            </div>
        </div>
    </div>
    
    <h3 id="level-info" class="glow-text" style="color: var(--cosmic-accent); font-family: 'Orbitron', monospace; font-size: 1.3rem;"></h3>
    
    <!-- Auto-start notification -->
    <div id="auto-start-notification" class="auto-start-notification hidden">
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; font-weight: 900; margin-bottom: 1.5rem;">‚ö° INIZIALIZZAZIONE BATTAGLIA AUTOMATICA</div>
            <div style="font-size: 2.5rem; margin: 1.5rem 0;">
                <span id="countdown" class="countdown">10</span>
            </div>
            <div style="font-size: 1.1rem; opacity: 0.9;">Il Comandante della Stazione pu√≤ iniziare immediatamente</div>
        </div>
    </div>

    <!-- Level completed notification -->
    <div id="level-completed-notification" class="level-completed hidden">
        <div style="text-align: center;">
            <h4 style="margin: 0 0 1.5rem 0; font-family: 'Bangers', cursive; font-size: 2.2rem; color: var(--cosmic-green);">
                üéâ SETTORE CONQUISTATO!
            </h4>
            <p id="level-winner" style="margin: 0; font-size: 1.4rem; font-weight: 700;"></p>
            <p id="level-score-info" style="margin: 1.5rem 0 0 0; font-size: 1.1rem; opacity: 0.9;"></p>
        </div>
    </div>
    
    <!-- Classifica Live -->
    <div class="leaderboard">
        <h4>üèÜ CLASSIFICA GALATTICA LIVE</h4>
        <div id="live-leaderboard"></div>
    </div>
    
    <div class="player-list">
        <div id="players-list"></div>
    </div>
    
    <div id="game-status" style="margin: 2.5rem 0;">
        <!-- Informazioni del livello -->
        <div id="level-display" class="level-display">
            <h4>üéØ OBIETTIVO SETTORE GALATTICO</h4>
            <p id="level-range" style="margin: 0; font-size: 1.5rem; font-weight: 900; color: var(--cosmic-accent);"></p>
            <p id="level-attempts" style="margin: 1.5rem 0 0 0; font-size: 1.1rem; opacity: 0.8;"></p>
        </div>
        
        <!-- Stato del turno -->
        <div class="cosmic-card">
            <p id="turnMessage" style="margin: 0; font-weight: 700; font-size: 1.3rem; text-align: center;"></p>
            <p id="gameInfo" style="margin: 1.5rem 0 0 0; font-size: 1.1rem; opacity: 0.8; text-align: center;"></p>
        </div>
    </div>
    
    <input type="number" id="userGuess" placeholder="üéØ Inserisci coordinate numeriche" style="text-align: center; font-size: 1.3rem;" class="interactive-element" />
    <button id="submitGuess" class="cosmic-sparkle interactive-element">üöÄ LANCIA ATTACCO</button>
    
    <div id="game-progress" class="cosmic-progress">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <span style="font-size: 1.1rem; opacity: 0.8;">ATTACCHI LANCIATI:</span><br>
                <span id="tentativi" style="font-size: 1.8rem; font-weight: 900; color: var(--cosmic-accent);">0</span>
                <span id="max-attempts" style="font-size: 1.1rem; opacity: 0.8;"></span>
            </div>
            <div id="attempts-remaining" style="font-size: 1.2rem; color: var(--cosmic-secondary); font-weight: 700;"></div>
        </div>
        <p id="message" style="font-weight: 700; text-align: center; margin: 2rem 0; font-size: 1.3rem; color: var(--cosmic-primary);"></p>
    </div>
    
    <div class="game-history">
        <div id="history-list"></div>
    </div>
    
    <div class="chat-container">
        <div id="chat-messages"></div>
    </div>
    
    <div style="display: flex; gap: 0.8rem; margin: 1.5rem 0;">
        <input type="text" id="chat-input" placeholder="üí¨ Messaggio per la flotta..." style="flex: 1;" class="interactive-element" />
        <button id="send-chat" style="width: auto; padding: 1.2rem 2rem; background: linear-gradient(45deg, var(--cosmic-green), #4caf50);" class="interactive-element">üì§</button>
    </div>
    
    <div style="margin-top: 2.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem;">
        <button id="leave-room-btn" class="btn-danger interactive-element">üö™ ABBANDONA STAZIONE</button>
        <button id="start-game-btn" class="hidden btn-success interactive-element">üöÄ INIZIA BATTAGLIA</button>
        <button id="next-level-btn" class="hidden btn-success interactive-element">‚û°Ô∏è SETTORE SUCCESSIVO</button>
        <button id="new-game-btn" class="hidden btn-success interactive-element">üîÑ NUOVA BATTAGLIA</button>
    </div>
</div>

<!-- Final Leaderboard Screen -->
<div class="container hidden" id="final-leaderboard-screen">
    <div class="winner-announcement">
        <h2 style="font-family: 'Bangers', cursive; font-size: 3rem; margin-bottom: 1.5rem;">
            üèÜ BATTAGLIA GALATTICA COMPLETATA!
        </h2>
        <p style="font-size: 1.5rem; font-weight: 700;">Tutti i 10 settori sono stati conquistati!</p>
        <div style="margin-top: 1.5rem; font-size: 4rem;">üåå‚ú®üöÄ</div>
    </div>
    
    <div class="leaderboard">
        <h3>ü•á HALL OF FAME GALATTICA</h3>
        <div id="final-leaderboard"></div>
    </div>
    
    <div class="cosmic-card">
        <h4 style="color: var(--cosmic-accent); font-family: 'Bangers', cursive; margin-bottom: 1.5rem;">üìà STATISTICHE BATTAGLIA FINALE:</h4>
        <div id="game-stats"></div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2.5rem;">
        <button id="play-again-btn" class="btn-success cosmic-sparkle interactive-element">üîÑ NUOVA BATTAGLIA</button>
        <button id="back-to-lobby-btn" class="btn-warning interactive-element">üè† RITORNA ALLA BASE</button>
    </div>
</div>

<script>
// CONFIGURAZIONE GLOBALE
let socket = null;
let isConnected = false;
let gameState = {
    currentLevel: 1,
    maxLevel: 10,
    targetNumber: 0,
    attempts: 0,
    maxAttempts: 10,
    score: 0,
    difficulty: 'easy',
    range: { min: 1, max: 30 },
    gameHistory: [],
    players: {},
    roomCode: '',
    isHost: false,
    gameStarted: false,
    levelCompleted: false
};

// INIZIALIZZAZIONE AVANZATA
document.addEventListener('DOMContentLoaded', function() {
    initializeCosmicEffects();
    initializeParticles();
    createStarField();
    createShootingStars();
    initializeAuroraEffects();
    initializeGame();
});

function initializeGame() {
    // Prova a connettersi al server Socket.io
    connectToServer();
    
    // Setup event listeners
    setupEventListeners();
    
    // Carica il nome del giocatore salvato
    const savedName = localStorage.getItem('numeroquest_player_name');
    if (savedName) {
        document.getElementById('playerName').value = savedName;
    }
}

function connectToServer() {
    try {
        // Configurazione avanzata per connessione multipla
        const serverConfigs = [
            window.location.origin,
            'http://localhost:3000',
            'https://your-server-domain.com' // Sostituisci con il tuo dominio
        ];
        
        let connectionAttempts = 0;
        const maxAttempts = serverConfigs.length;
        
        function tryConnection(configIndex = 0) {
            if (configIndex >= maxAttempts) {
                handleConnectionError();
                return;
            }
            
            const serverUrl = serverConfigs[configIndex];
            console.log(`Tentativo di connessione a: ${serverUrl}`);
            
            socket = io(serverUrl, {
                transports: ['websocket', 'polling'],
                timeout: 3000,
                forceNew: true,
                autoConnect: true
            });

            socket.on('connect', () => {
                console.log(`Connesso al server Socket.io: ${serverUrl}`);
                isConnected = true;
                updateConnectionStatus('online', 'Connesso al Network Galattico');
                document.getElementById('connection-error').classList.add('hidden');
                document.getElementById('online-features').classList.remove('hidden');
                showCosmicNotification('üåå Connesso al Network Galattico!', 'success');
            });

            socket.on('disconnect', () => {
                console.log('Disconnesso dal server');
                isConnected = false;
                updateConnectionStatus('offline', 'Disconnesso dal Network Galattico');
                showCosmicNotification('‚ö†Ô∏è Connessione persa', 'warning');
            });

            socket.on('connect_error', (error) => {
                console.log(`Errore di connessione a ${serverUrl}:`, error);
                connectionAttempts++;
                
                if (connectionAttempts < maxAttempts) {
                    setTimeout(() => tryConnection(configIndex + 1), 1000);
                } else {
                    handleConnectionError();
                }
            });

            // Setup game event listeners
            setupSocketListeners();
        }
        
        // Inizia il primo tentativo
        tryConnection();

        // Timeout globale per la connessione
        setTimeout(() => {
            if (!isConnected) {
                handleConnectionError();
            }
        }, 8000);

    } catch (error) {
        console.log('Errore nell\'inizializzazione Socket.io:', error);
        handleConnectionError();
    }
}

function handleConnectionError() {
    isConnected = false;
    updateConnectionStatus('offline', 'Connessione Non Disponibile');
    document.getElementById('connection-error').classList.remove('hidden');
    document.getElementById('online-features').classList.add('hidden');
    showCosmicNotification('üîå Impossibile connettersi al server', 'error');
}

function updateConnectionStatus(status, text) {
    const statusIndicator = document.getElementById('connectionStatus');
    const connectionText = document.getElementById('connectionText');
    
    statusIndicator.className = `status-indicator status-${status}`;
    connectionText.textContent = text;
}

function setupEventListeners() {
    // Lobby buttons
    document.getElementById('create-game-btn').addEventListener('click', createGame);
    document.getElementById('join-game-btn').addEventListener('click', joinGame);
    document.getElementById('random-room-btn').addEventListener('click', joinRandomRoom);
    document.getElementById('public-rooms-btn').addEventListener('click', togglePublicRooms);
    document.getElementById('retry-connection-btn').addEventListener('click', retryConnection);
    
    // Game buttons
    document.getElementById('submitGuess').addEventListener('click', submitGuess);
    document.getElementById('start-game-btn').addEventListener('click', startGame);
    document.getElementById('next-level-btn').addEventListener('click', nextLevel);
    document.getElementById('new-game-btn').addEventListener('click', newGame);
    document.getElementById('leave-room-btn').addEventListener('click', leaveRoom);
    document.getElementById('send-chat').addEventListener('click', sendChatMessage);
    
    // Final screen buttons
    document.getElementById('play-again-btn').addEventListener('click', playAgain);
    document.getElementById('back-to-lobby-btn').addEventListener('click', backToLobby);
    
    // Input handlers
    document.getElementById('userGuess').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            submitGuess();
        }
    });
    
    document.getElementById('chat-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendChatMessage();
        }
    });
    
    document.getElementById('room-code').addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase();
    });
}

function retryConnection() {
    showCosmicNotification('üîÑ Tentativo di riconnessione...', 'info');
    connectToServer();
}

function setupSocketListeners() {
    if (!socket) return;
    
    socket.on('roomCreated', (data) => {
        gameState.roomCode = data.roomCode;
        gameState.isHost = true;
        showGame();
        updateRoomDisplay();
        showCosmicNotification('üè† Stazione Spaziale Creata!', 'success');
        triggerCosmicConfetti();
    });
    
    socket.on('roomJoined', (data) => {
        gameState.roomCode = data.roomCode;
        gameState.isHost = data.isHost;
        gameState.players = data.players;
        gameState.difficulty = data.difficulty;
        showGame();
        updateRoomDisplay();
        updatePlayersList();
        showCosmicNotification('üö™ Entrato nella Stazione!', 'success');
    });
    
    socket.on('playerJoined', (data) => {
        gameState.players = data.players;
        updatePlayersList();
        addChatMessage(`üöÄ ${data.playerName} √® entrato nella stazione!`, 'system');
        showCosmicNotification(`üöÄ ${data.playerName} si √® unito!`, 'info');
    });
    
    socket.on('playerLeft', (data) => {
        gameState.players = data.players;
        updatePlayersList();
        addChatMessage(`üö™ ${data.playerName} ha abbandonato la stazione.`, 'system');
    });
    
    socket.on('gameStarted', (data) => {
        gameState.gameStarted = true;
        gameState.currentLevel = data.level;
        gameState.targetNumber = data.targetNumber;
        gameState.range = data.range;
        gameState.maxAttempts = data.maxAttempts;
        startLevel();
        addChatMessage('üöÄ La battaglia √® iniziata!', 'system');
        showCosmicNotification('‚ö° Battaglia Iniziata!', 'success');
    });
    
    socket.on('guessResult', (data) => {
        handleGuessResult(data);
    });
    
    socket.on('levelCompleted', (data) => {
        handleLevelCompleted(data);
    });
    
    socket.on('gameCompleted', (data) => {
        handleGameCompleted(data);
    });
    
    socket.on('chatMessage', (data) => {
        addChatMessage(`${data.playerName}: ${data.message}`, data.isOwn ? 'own' : 'player');
    });
    
    socket.on('publicRooms', (data) => {
        displayPublicRooms(data.rooms);
    });
    
    socket.on('error', (data) => {
        showCosmicNotification(data.message, 'error');
    });
}

// FUNZIONI DI GIOCO MULTIPLAYER
function createGame() {
    if (!isConnected) {
        showCosmicNotification('‚ùå Non connesso al server!', 'error');
        return;
    }
    
    const playerName = document.getElementById('playerName').value.trim();
    if (!playerName) {
        showCosmicNotification('‚ùå Inserisci il tuo nome da Comandante!', 'error');
        return;
    }
    
    const difficulty = document.getElementById('difficulty').value;
    
    // Salva il nome del giocatore
    localStorage.setItem('numeroquest_player_name', playerName);
    
    socket.emit('createRoom', { playerName, difficulty });
}

function joinGame() {
    if (!isConnected) {
        showCosmicNotification('‚ùå Non connesso al server!', 'error');
        return;
    }
    
    const playerName = document.getElementById('playerName').value.trim();
    const roomCode = document.getElementById('room-code').value.trim();
    
    if (!playerName) {
        showCosmicNotification('‚ùå Inserisci il tuo nome da Comandante!', 'error');
        return;
    }
    
    if (!roomCode) {
        showCosmicNotification('‚ùå Inserisci il codice della stazione!', 'error');
        return;
    }
    
    // Salva il nome del giocatore
    localStorage.setItem('numeroquest_player_name', playerName);
    
    socket.emit('joinRoom', { playerName, roomCode });
}

function joinRandomRoom() {
    if (!isConnected) {
        showCosmicNotification('‚ùå Non connesso al server!', 'error');
        return;
    }
    
    const playerName = document.getElementById('playerName').value.trim();
    if (!playerName) {
        showCosmicNotification('‚ùå Inserisci il tuo nome da Comandante!', 'error');
        return;
    }
    
    // Salva il nome del giocatore
    localStorage.setItem('numeroquest_player_name', playerName);
    
    socket.emit('joinRandomRoom', { playerName });
}

function togglePublicRooms() {
    if (!isConnected) {
        showCosmicNotification('‚ùå Non connesso al server!', 'error');
        return;
    }
    
    const roomsList = document.getElementById('publicRoomsList');
    if (roomsList.classList.contains('hidden')) {
        socket.emit('getPublicRooms');
        roomsList.classList.remove('hidden');
    } else {
        roomsList.classList.add('hidden');
    }
}

function displayPublicRooms(rooms) {
    const roomsList = document.getElementById('roomsList');
    roomsList.innerHTML = '';
    
    if (rooms.length === 0) {
        roomsList.innerHTML = '<p style="text-align: center; opacity: 0.7; font-size: 1.1rem;">Nessuna stazione pubblica disponibile</p>';
        return;
    }
    
    rooms.forEach(room => {
        const roomElement = document.createElement('div');
        roomElement.className = 'cosmic-card interactive-element';
        roomElement.style.cursor = 'pointer';
        roomElement.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong style="color: var(--cosmic-primary); font-size: 1.2rem;">${room.code}</strong><br>
                    <small style="opacity: 0.8;">Giocatori: ${room.playerCount}/8 | Difficolt√†: ${getDifficultyName(room.difficulty)}</small>
                </div>
                <button class="btn-secondary" style="width: auto; padding: 0.8rem 1.5rem; margin: 0;">
                    üö™ ENTRA
                </button>
            </div>
        `;
        
        roomElement.addEventListener('click', () => {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showCosmicNotification('‚ùå Inserisci il tuo nome da Comandante!', 'error');
                return;
            }
            
            localStorage.setItem('numeroquest_player_name', playerName);
            socket.emit('joinRoom', { playerName, roomCode: room.code });
        });
        
        roomsList.appendChild(roomElement);
    });
}

function getDifficultyName(difficulty) {
    const names = {
        easy: 'üß© FACILE',
        medium: '‚öîÔ∏è MEDIO',
        hard: 'üî• DIFFICILE',
        hardcore: 'üíÄ HARDCORE'
    };
    return names[difficulty] || difficulty;
}

// FUNZIONI DI GESTIONE SCHERMATA
function showGame() {
    document.getElementById('lobby').classList.add('hidden');
    document.getElementById('game').classList.remove('hidden');
    document.getElementById('final-leaderboard-screen').classList.add('hidden');
}

function showLobby() {
    document.getElementById('lobby').classList.remove('hidden');
    document.getElementById('game').classList.add('hidden');
    document.getElementById('final-leaderboard-screen').classList.add('hidden');
}

function showFinalLeaderboard() {
    document.getElementById('lobby').classList.add('hidden');
    document.getElementById('game').classList.add('hidden');
    document.getElementById('final-leaderboard-screen').classList.remove('hidden');
}

function updateRoomDisplay() {
    document.getElementById('room-code-display').textContent = gameState.roomCode;
}

function updatePlayersList() {
    const playersList = document.getElementById('players-list');
    playersList.innerHTML = '';
    
    Object.values(gameState.players).forEach(player => {
        const playerElement = document.createElement('div');
        playerElement.className = `player-item ${player.isHost ? 'host' : ''}`;
        playerElement.innerHTML = `
            <div>
                <strong style="font-size: 1.1rem;">${player.name}</strong>
                ${player.isHost ? '<span style="color: var(--cosmic-accent); margin-left: 0.8rem; font-size: 0.9rem;">üëë COMANDANTE</span>' : ''}
            </div>
            <div style="color: var(--cosmic-accent); font-weight: 900; font-size: 1.2rem;">
                ${player.score || 0} pts
            </div>
        `;
        playersList.appendChild(playerElement);
    });
}

// FUNZIONI DI GIOCO
function startGame() {
    if (!gameState.isHost) {
        showCosmicNotification('‚ùå Solo il Comandante pu√≤ iniziare la battaglia!', 'error');
        return;
    }
    
    socket.emit('startGame', { roomCode: gameState.roomCode });
}

function startLevel() {
    gameState.attempts = 0;
    gameState.gameHistory = [];
    gameState.levelCompleted = false;
    
    updateLevelDisplay();
    updateGameProgress();
    
    document.getElementById('submitGuess').disabled = false;
    document.getElementById('userGuess').disabled = false;
    document.getElementById('userGuess').value = '';
    document.getElementById('userGuess').focus();
    
    document.getElementById('start-game-btn').classList.add('hidden');
    document.getElementById('next-level-btn').classList.add('hidden');
    document.getElementById('new-game-btn').classList.add('hidden');
    document.getElementById('auto-start-notification').classList.add('hidden');
    document.getElementById('level-completed-notification').classList.add('hidden');
}

function updateLevelDisplay() {
    document.getElementById('current-level').textContent = gameState.currentLevel;
    document.getElementById('level-range').textContent = `Trova il numero tra ${gameState.range.min} e ${gameState.range.max}`;
    document.getElementById('level-attempts').textContent = `Hai ${gameState.maxAttempts} attacchi disponibili`;
    document.getElementById('max-attempts').textContent = ` / ${gameState.maxAttempts}`;
    
    const difficultyName = getDifficultyName(gameState.difficulty);
    document.getElementById('level-info').textContent = `${difficultyName} - Settore ${gameState.currentLevel}`;
}

function updateGameProgress() {
    document.getElementById('tentativi').textContent = gameState.attempts;
    document.getElementById('my-score').textContent = gameState.score;
    
    const remaining = gameState.maxAttempts - gameState.attempts;
    document.getElementById('attempts-remaining').textContent = `Attacchi rimanenti: ${remaining}`;
    
    if (remaining <= 2) {
        document.getElementById('attempts-remaining').style.color = 'var(--cosmic-secondary)';
    } else {
        document.getElementById('attempts-remaining').style.color = 'var(--cosmic-accent)';
    }
}

function submitGuess() {
    if (gameState.levelCompleted) return;
    
    const guess = parseInt(document.getElementById('userGuess').value);
    
    if (isNaN(guess) || guess < gameState.range.min || guess > gameState.range.max) {
        showCosmicNotification(`‚ùå Inserisci un numero tra ${gameState.range.min} e ${gameState.range.max}!`, 'error');
        return;
    }
    
    gameState.attempts++;
    
    socket.emit('makeGuess', { 
        roomCode: gameState.roomCode, 
        guess: guess 
    });
    
    document.getElementById('userGuess').value = '';
    updateGameProgress();
}

function nextLevel() {
    if (!gameState.isHost) {
        showCosmicNotification('‚ùå Solo il Comandante pu√≤ avanzare al settore successivo!', 'error');
        return;
    }
    socket.emit('nextLevel', { roomCode: gameState.roomCode });
}

function newGame() {
    gameState.currentLevel = 1;
    gameState.score = 0;
    gameState.attempts = 0;
    gameState.gameHistory = [];
    
    if (!gameState.isHost) {
        showCosmicNotification('‚ùå Solo il Comandante pu√≤ iniziare una nuova battaglia!', 'error');
        return;
    }
    socket.emit('newGame', { roomCode: gameState.roomCode });
}

function handleGuessResult(data) {
    const { result, message, points, gameHistory, playerScores } = data;
    
    if (points) {
        gameState.score += points;
    }
    
    gameState.gameHistory = gameHistory;
    
    // Aggiorna i punteggi dei giocatori
    Object.keys(playerScores).forEach(playerId => {
        if (gameState.players[playerId]) {
            gameState.players[playerId].score = playerScores[playerId];
        }
    });
    
    updateHistoryDisplay();
    updatePlayersList();
    updateLiveLeaderboard();
    document.getElementById('message').textContent = message;
    
    if (result === 'correct') {
        gameState.levelCompleted = true;
        document.getElementById('submitGuess').disabled = true;
        document.getElementById('userGuess').disabled = true;
        triggerCosmicConfetti();
    }
}

function handleLevelCompleted(data) {
    const { winner, targetNumber, level, finalScores } = data;
    
    gameState.levelCompleted = true;
    document.getElementById('submitGuess').disabled = true;
    document.getElementById('userGuess').disabled = true;
    
    // Aggiorna i punteggi finali
    Object.keys(finalScores).forEach(playerId => {
        if (gameState.players[playerId]) {
            gameState.players[playerId].score = finalScores[playerId];
        }
    });
    
    // Mostra notifica livello completato
    document.getElementById('level-winner').textContent = `${winner.name} ha conquistato il settore!`;
    document.getElementById('level-score-info').textContent = `Numero: ${targetNumber} trovato in ${winner.attempts} tentativi`;
    document.getElementById('level-completed-notification').classList.remove('hidden');
    
    updatePlayersList();
    updateLiveLeaderboard();
    triggerCosmicConfetti();
    
    setTimeout(() => {
        document.getElementById('level-completed-notification').classList.add('hidden');
        
        if (gameState.isHost) {
            if (level >= gameState.maxLevel) {
                document.getElementById('new-game-btn').classList.remove('hidden');
            } else {
                document.getElementById('next-level-btn').classList.remove('hidden');
            }
        }
    }, 3000);
}

function handleGameCompleted(data) {
    const { finalLeaderboard, gameStats } = data;
    
    showFinalLeaderboard();
    displayFinalLeaderboard(finalLeaderboard);
    displayGameStats(gameStats);
    triggerCosmicConfetti();
    showCosmicNotification('üèÜ Battaglia Galattica Completata!', 'success');
}

function updateHistoryDisplay() {
    const historyList = document.getElementById('history-list');
    historyList.innerHTML = '';
    
    gameState.gameHistory.slice(0, 10).forEach((item, index) => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        
        let resultColor = 'var(--cosmic-primary)';
        if (item.result === 'correct') resultColor = 'var(--cosmic-green)';
        else if (item.result === 'very_close') resultColor = 'var(--cosmic-accent)';
        else if (item.result === 'close') resultColor = 'var(--cosmic-orange)';
        else if (item.result === 'far') resultColor = 'var(--cosmic-secondary)';
        
        historyItem.innerHTML = `
            <div style="color: ${resultColor}; font-weight: 900; font-size: 1.2rem;">${item.guess}</div>
            <div style="font-size: 1rem; opacity: 0.8;">${item.message}</div>
        `;
        
        historyList.appendChild(historyItem);
    });
}

function updateLiveLeaderboard() {
    const leaderboard = document.getElementById('live-leaderboard');
    leaderboard.innerHTML = '';
    
    const sortedPlayers = Object.values(gameState.players)
        .sort((a, b) => (b.score || 0) - (a.score || 0));
    
    sortedPlayers.forEach((player, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboard-item';
        
        if (index === 0) item.classList.add('first');
        else if (index === 1) item.classList.add('second');
        else if (index === 2) item.classList.add('third');
        
        item.innerHTML = `
            <div>
                <strong style="font-size: 1.2rem;">${player.name}</strong>
                ${player.isHost ? '<span style="color: var(--cosmic-accent); margin-left: 0.8rem;">üëë</span>' : ''}
            </div>
            <div style="font-weight: 900; font-size: 1.4rem;">
                ${player.score || 0} pts
            </div>
        `;
        
        leaderboard.appendChild(item);
    });
}

function displayFinalLeaderboard(leaderboard = null) {
    const finalLeaderboard = document.getElementById('final-leaderboard');
    finalLeaderboard.innerHTML = '';
    
    const players = leaderboard || Object.values(gameState.players)
        .sort((a, b) => (b.score || 0) - (a.score || 0));
    
    players.forEach((player, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboard-item';
        
        if (index === 0) item.classList.add('first');
        else if (index === 1) item.classList.add('second');
        else if (index === 2) item.classList.add('third');
        
        item.innerHTML = `
            <div>
                <strong style="font-size: 1.3rem;">${player.name}</strong>
                ${player.isHost ? '<span style="color: var(--cosmic-accent); margin-left: 0.8rem;">üëë</span>' : ''}
            </div>
            <div style="font-weight: 900; font-size: 1.5rem;">
                ${player.score || 0} pts
            </div>
        `;
        
        finalLeaderboard.appendChild(item);
    });
}

function displayGameStats(stats = null) {
    const gameStats = document.getElementById('game-stats');
    
    if (stats) {
        gameStats.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; text-align: center;">
                <div style="background: rgba(0,255,242,0.1); padding: 1.5rem; border-radius: 15px; border: 2px solid var(--cosmic-primary);">
                    <strong style="color: var(--cosmic-primary); font-size: 1.1rem;">Settori Completati</strong><br>
                    <span style="font-size: 1.8rem; font-weight: 900; color: var(--cosmic-accent);">${stats.levelsCompleted}</span>
                </div>
                <div style="background: rgba(255,215,61,0.1); padding: 1.5rem; border-radius: 15px; border: 2px solid var(--cosmic-accent);">
                    <strong style="color: var(--cosmic-accent); font-size: 1.1rem;">Tentativi Totali</strong><br>
                    <span style="font-size: 1.8rem; font-weight: 900; color: var(--cosmic-primary);">${stats.totalAttempts}</span>
                </div>
                <div style="background: rgba(0,255,102,0.1); padding: 1.5rem; border-radius: 15px; border: 2px solid var(--cosmic-green);">
                    <strong style="color: var(--cosmic-green); font-size: 1.1rem;">Tempo di Gioco</strong><br>
                    <span style="font-size: 1.8rem; font-weight: 900; color: var(--cosmic-accent);">${stats.gameTime}</span>
                </div>
            </div>
        `;
    }
}

// FUNZIONI CHAT
function sendChatMessage() {
    const chatInput = document.getElementById('chat-input');
    const message = chatInput.value.trim();
    
    if (!message) return;
    
    socket.emit('chatMessage', { 
        roomCode: gameState.roomCode, 
        message: message 
    });
    
    chatInput.value = '';
}

function addChatMessage(message, type = 'player') {
    const chatMessages = document.getElementById('chat-messages');
    const messageElement = document.createElement('div');
    messageElement.className = `chat-message ${type}`;
    messageElement.textContent = message;
    
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Limita a 50 messaggi
    while (chatMessages.children.length > 50) {
        chatMessages.removeChild(chatMessages.firstChild);
    }
}

// FUNZIONI DI NAVIGAZIONE
function leaveRoom() {
    if (isConnected) {
        socket.emit('leaveRoom', { roomCode: gameState.roomCode });
    }
    
    // Reset game state
    gameState = {
        currentLevel: 1,
        maxLevel: 10,
        targetNumber: 0,
        attempts: 0,
        maxAttempts: 10,
        score: 0,
        difficulty: 'easy',
        range: { min: 1, max: 30 },
        gameHistory: [],
        players: {},
        roomCode: '',
        isHost: false,
        gameStarted: false,
        levelCompleted: false
    };
    
    showLobby();
    showCosmicNotification('üö™ Hai abbandonato la stazione', 'info');
}

function playAgain() {
    gameState.currentLevel = 1;
    gameState.score = 0;
    gameState.attempts = 0;
    gameState.gameHistory = [];
    
    // Reset player scores
    Object.keys(gameState.players).forEach(playerId => {
        gameState.players[playerId].score = 0;
    });
    
    showGame();
    updatePlayersList();
    updateLiveLeaderboard();
    
    if (gameState.isHost) {
        socket.emit('newGame', { roomCode: gameState.roomCode });
    }
}

function backToLobby() {
    leaveRoom();
}

// INIZIALIZZAZIONE EFFETTI COSMICI AVANZATI
function initializeCosmicEffects() {
    // Aggiungi effetti di hover dinamici avanzati
    const interactiveElements = document.querySelectorAll('.interactive-element');
    interactiveElements.forEach(element => {
        element.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-3px) scale(1.02)';
            this.style.filter = 'brightness(1.1)';
        });
        
        element.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
            this.style.filter = 'brightness(1)';
        });
    });

    // Effetti per i containers
    const containers = document.querySelectorAll('.container');
    containers.forEach(container => {
        container.addEventListener('mouseenter', function() {
            this.style.boxShadow = '0 0 60px rgba(0,255,242,0.5)';
        });
        
        container.addEventListener('mouseleave', function() {
            this.style.boxShadow = '0 0 40px rgba(0,255,242,0.3)';
        });
    });
}

function initializeParticles() {
    particlesJS("particles-js", {
        particles: {
            number: { value: 150, density: { enable: true, value_area: 800 } },
            color: { value: ["#00fff2", "#ff6b6b", "#ffd93d", "#9966ff", "#00ff66", "#ff6600"] },
            shape: { 
                type: ["circle", "triangle", "polygon", "star"],
                polygon: { nb_sides: 6 },
                star: { nb_sides: 5 }
            },
            opacity: { 
                value: 0.9, 
                random: true,
                anim: { enable: true, speed: 2, opacity_min: 0.3 }
            },
            size: { 
                value: 6, 
                random: true,
                anim: { enable: true, speed: 4, size_min: 2 }
            },
            line_linked: {
                enable: true,
                distance: 200,
                color: "#00fff2",
                opacity: 0.8,
                width: 2
            },
            move: {
                enable: true,
                speed: 5,
                direction: "none",
                random: true,
                straight: false,
                out_mode: "out",
                bounce: false,
                attract: { enable: true, rotateX: 1000, rotateY: 2000 }
            }
        },
        interactivity: {
            detect_on: "canvas",
            events: {
                onhover: { enable: true, mode: "repulse" },
                onclick: { enable: true, mode: "push" },
                resize: true
            },
            modes: {
                repulse: { distance: 200, duration: 0.5 },
                push: { particles_nb: 10 }
            }
        },
        retina_detect: true
    });
}

function createStarField() {
    const starsField = document.getElementById('starsField');
    const numStars = 300;
    
    for (let i = 0; i < numStars; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.width = star.style.height = (Math.random() * 4 + 1) + 'px';
        star.style.animationDelay = Math.random() * 4 + 's';
        star.style.animationDuration = (Math.random() * 6 + 3) + 's';
        starsField.appendChild(star);
    }
}

function createShootingStars() {
    setInterval(() => {
        const shootingStar = document.createElement('div');
        shootingStar.className = 'shooting-star';
        shootingStar.style.left = Math.random() * 100 + '%';
        shootingStar.style.top = Math.random() * 50 + '%';
        document.getElementById('starsField').appendChild(shootingStar);
        
        setTimeout(() => {
            shootingStar.remove();
        }, 5000);
    }, 2500);
}

function initializeAuroraEffects() {
    // Crea effetti aurora aggiuntivi
    const auroraLayer = document.querySelector('.aurora-layer');
    if (auroraLayer) {
        setInterval(() => {
            const randomHue = Math.random() * 360;
            auroraLayer.style.filter = `hue-rotate(${randomHue}deg)`;
        }, 5000);
    }
}

// FUNZIONE PER TORNARE AL MENU PRINCIPALE
function goHome() {
    // Controlla se esiste un URL di ritorno salvato
    const returnUrl = localStorage.getItem('numeroquest_return_url');
    if (returnUrl) {
        window.location.href = returnUrl;
    } else {
        // Fallback al file index.html
        window.location.href = 'index.html';
    }
}

// EFFETTI CONFETTI COSMICI AVANZATI
function triggerCosmicConfetti() {
    const colors = ['#00fff2', '#ff6b6b', '#ffd93d', '#9966ff', '#00ff66', '#ff6600'];
    
    // Primo burst centrale
    confetti({
        particleCount: 250,
        spread: 120,
        origin: { y: 0.6 },
        colors: colors,
        shapes: ['star', 'circle'],
        gravity: 0.9,
        drift: 0.1,
        scalar: 1.2
    });
    
    // Secondo burst da sinistra
    setTimeout(() => {
        confetti({
            particleCount: 150,
            spread: 80,
            origin: { x: 0.1, y: 0.7 },
            colors: colors,
            shapes: ['star'],
            gravity: 0.7,
            angle: 60
        });
    }, 300);
    
    // Terzo burst da destra
    setTimeout(() => {
        confetti({
            particleCount: 150,
            spread: 80,
            origin: { x: 0.9, y: 0.7 },
            colors: colors,
            shapes: ['star'],
            gravity: 0.7,
            angle: 120
        });
    }, 600);
}

// NOTIFICHE COSMICHE AVANZATE
function showCosmicNotification(message, type = 'info') {
    const notification = document.createElement('div');
    
    let borderColor = 'var(--cosmic-primary)';
    let bgColor = 'rgba(0,255,242,0.1)';
    
    switch(type) {
        case 'success':
            borderColor = 'var(--cosmic-green)';
            bgColor = 'rgba(0,255,102,0.1)';
            break;
        case 'error':
            borderColor = 'var(--cosmic-secondary)';
            bgColor = 'rgba(255,107,107,0.1)';
            break;
        case 'warning':
            borderColor = 'var(--cosmic-accent)';
            bgColor = 'rgba(255,215,61,0.1)';
            break;
    }
    
    notification.style.cssText = `
        position: fixed;
        top: 30px;
        right: 30px;
        background: ${bgColor};
        backdrop-filter: blur(15px);
        color: white;
        padding: 1.5rem 2.5rem;
        border-radius: 20px;
        border: 3px solid ${borderColor};
        z-index: 10000;
        animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 700;
        font-size: 1.1rem;
        box-shadow: 0 0 30px ${borderColor.replace('var(--cosmic-', 'rgba(').replace(')', ', 0.4)')};
        max-width: 350px;
    `;
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        setTimeout(() => notification.remove(), 600);
    }, 4000);
}

// AGGIUNGI STILI PER LE ANIMAZIONI DELLE NOTIFICHE AVANZATE
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { 
            transform: translateX(100%) scale(0.8); 
            opacity: 0; 
        }
        to { 
            transform: translateX(0) scale(1); 
            opacity: 1; 
        }
    }
    
    @keyframes slideOutRight {
        from { 
            transform: translateX(0) scale(1); 
            opacity: 1; 
        }
        to { 
            transform: translateX(100%) scale(0.8); 
            opacity: 0; 
        }
    }
`;
document.head.appendChild(style);
</script>

</body>
</html>
